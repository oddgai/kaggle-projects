# exp005 実験計画: アンサンブル手法による0.8突破

## 📊 現状分析

### これまでの成果
- **exp001 (ベースライン)**: 0.77272
- **exp004 (特徴量ENG)**: 0.77990 (+0.00718)
- **目標**: 0.80000突破 (+0.02010必要)

### EDA結果からの重要な発見

#### 1. 効果的な交互作用パターン
- **Title × Pclass**: 敬称と客室クラスの組み合わせで大きな生存率差
- **Sex × Pclass × Age_Group**: 3次交互作用で細かい生存パターン
- **Cabin_Deck × Age**: デッキ位置と年齢の関係性

#### 2. PassengerIdの順序性
- 乗船順序に若干の生存率変動あり
- 10グループ分割で最大0.1の生存率差を確認

#### 3. 新特徴量の有効性
- 相対順位特徴量（Fare_Pclass_Rank等）が有効
- Title基準の偏差特徴量（Age_vs_TitleMean等）が効果的

## 🎯 exp005戦略: 多段階アンサンブル

### Stage 1: 強化された特徴量エンジニアリング
1. **3次交互作用特徴量**
   - Sex × Pclass × Age_Group
   - Title × Pclass × Embarked
   - Cabin_Deck × Class × Age

2. **順序・ランク特徴量**
   - PassengerId_Rank（乗船順序）
   - Fare_Pclass_Rank（クラス内運賃順位）
   - Age_Rank_in_Family（家族内年齢順位）

3. **統計的偏差特徴量**
   - Age_vs_TitleMean（敬称平均からの年齢偏差）
   - Fare_vs_TitleMean（敬称平均からの運賃偏差）

### Stage 2: 多様性アンサンブル
3つの異なるアルゴリズムを使用：

#### Model A: LightGBM (exp004ベース)
- 既存の最適パラメータをベース
- 新特徴量を追加して再訓練

#### Model B: XGBoost 
- 異なる正則化アプローチ
- LightGBMとは異なるバイアス

#### Model C: CatBoost
- カテゴリカル特徴量の自動処理
- 過学習耐性が高い

### Stage 3: ハイパーパラメータ最適化
- **Optuna**による各モデルの最適化
- 100試行以上での徹底的な探索
- Cross-validationスコアでの最適化

### Stage 4: アンサンブル手法
1. **単純平均**: 3モデルの予測値平均
2. **重み付き平均**: CV性能による重み
3. **Stacking**: メタモデルによる組み合わせ最適化

## 📈 期待効果と目標

### 各段階の期待改善幅
- **特徴量強化**: +0.003～0.007
- **多様性アンサンブル**: +0.005～0.010  
- **ハイパーパラメータ最適化**: +0.002～0.005
- **アンサンブル最適化**: +0.003～0.007

### **総合期待改善**: +0.013～0.029
### **目標Kaggleスコア**: 0.805～0.808

## 🛠 実装計画

### Phase 1: 強化特徴量エンジニアリング (1-2時間)
1. exp004の特徴量にEDA結果の新特徴量を追加
2. 特徴量重要度による効果検証
3. LightGBMベースラインでの性能確認

### Phase 2: 多モデル実装 (2-3時間)
1. XGBoost実装・調整
2. CatBoost実装・調整  
3. 3モデルの個別性能評価

### Phase 3: 最適化 (2-3時間)
1. Optunaによる各モデル最適化
2. アンサンブル重みの最適化
3. Stackingメタモデルの構築

### Phase 4: 最終評価 (30分-1時間)
1. 最終アンサンブルモデル構築
2. テストデータ予測
3. 提出ファイル生成

## 🎲 リスク要因と対策

### 主要リスク
1. **オーバーフィッティング**: CV vs Kaggle精度の乖離拡大
2. **計算時間**: 最適化の長時間実行
3. **メモリ使用量**: 複数モデル同時実行

### 対策
1. **Early Stopping強化**: 各モデルで厳格な過学習防止
2. **段階的実行**: Phase毎に中間結果を保存
3. **メモリ管理**: モデル毎にメモリクリア

## 📋 成功基準

### 最低目標
- **Kaggleスコア**: 0.78500以上（+0.00510）
- **CV安定性**: 標準偏差0.040以下

### 理想目標  
- **Kaggleスコア**: 0.80000以上（+0.02010）
- **上位30%以内**のランキング

### 革新目標
- **Kaggleスコア**: 0.82000以上（+0.04010）  
- **上位10%以内**のランキング

---

## 🚀 次のアクション

1. **Phase 1開始**: 強化特徴量エンジニアリング実装
2. **XGBoost/CatBoos**t環境確認とテスト実行
3. **Optuna**最適化フレームワーク構築

**期待される成果**: Titanicコンペティションでの大幅なスコア向上と、アンサンブル手法の実践的習得